{% extends "custom.html" %}



{% block content %}

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class=flashes>
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <div class="container-fluid">
        <form action="/register/" method="post">
            <div class="row">
                <div class="col-md-4 col-md-offset-4 text-center">
                    <h1>Register Access Card</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-md-2 col-md-offset-5 text-center">
                    <div class="form-group">
                        <label for="access_id">Access Card ID:</label>
                        <input type="text" class="form-control" id="access_id" name="access_id">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-2 col-md-offset-5 text-center">
                    <div class="form-group">
                        <label for="user_name">User Name:</label>
                        <select class="selectpicker" id="user_name" name="user_name" data-width="100%" title="Select a user name...">
                            {% for name in ldap %}
                            <option value="{{ name }}">{{ name }}</option>
                            {%  endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-2 col-md-offset-5 text-center">
                    <input type="hidden" name="register" value="true">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-primary btn-update">Refresh</button>
                </div>
            </div>
        </form>
    </div>

{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="application/javascript">

    $(".btn-update").click(function(){
        $.post("/ui/",
                {
                   rfid: 'true'
                },
        function(data,status){
            $('#access_id').val(data);
        });
    });
    {# run on a 5 second timer() #}{#
    var run_update = function(){
        $.post("/ui/",
                {
                   rfid: 'true'
                },
        function(data,status){
            $('#access_id').val(data);
        });
    };  #}

    var interval = 5000;

    setInterval(run_update, interval);
    </script>
{% endblock %}